"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = async () => {
    const proc = global.edgedbProc;
    const conn = global.edgedbConn;
    console.log("Shutting down EdgeDB test cluster...");
    await conn.close();
    try {
        await new Promise((resolve, reject) => {
            const to = setTimeout(() => {
                console.error("!!! EdgeDB exit timeout... !!!");
                proc.kill("SIGTERM");
            }, 5000);
            proc.on("exit", (code, signal) => {
                clearTimeout(to);
                if (signal === "SIGTERM") {
                    reject(new Error("edgedb did not shutdown gracefully"));
                }
                else {
                    resolve();
                }
            });
            proc.on("error", (error) => {
                clearTimeout(to);
                reject(error);
            });
        });
    }
    finally {
        console.log("EdgeDB test cluster is down...");
    }
};
